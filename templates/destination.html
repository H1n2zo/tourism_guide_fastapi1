<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ destination.name }} - Tourism Guide</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/lightbox2/2.11.3/css/lightbox.min.css">
    <link rel="stylesheet" href="/static/css/base.css">
    <style>
        .hero-image {
            height: 500px;
            background-size: cover;
            background-position: center;
            position: relative;
        }
        .hero-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(to top, rgba(0,0,0,0.8), transparent);
            color: white;
            padding: 40px;
        }
        .info-card {
            border-left: 4px solid #667eea;
            background: #f8f9fa;
            padding: 15px;
            margin-bottom: 15px;
        }
        .rating {
            color: #ffc107;
            font-size: 1.2rem;
        }
        #map {
            height: 400px;
            border-radius: 10px;
        }
        .gallery-img {
            height: 150px;
            object-fit: cover;
            border-radius: 5px;
            cursor: pointer;
            transition: transform 0.3s;
        }
        .gallery-img:hover {
            transform: scale(1.05);
        }
        .review-card {
            border-left: 4px solid #28a745;
            background: #f8f9fa;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 5px;
        }
        .review-rating {
            color: #ffc107;
            font-size: 1rem;
        }
        .star-rating {
            display: flex;
            gap: 5px;
            font-size: 2rem;
            cursor: pointer;
        }
        .star-rating i {
            color: #ddd;
            transition: color 0.2s;
        }
        .star-rating i.active,
        .star-rating i:hover,
        .star-rating i:hover ~ i {
            color: #ffc107;
        }
        .breadcrumb {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <!-- Back to Top Button -->
    <button id="backToTop" title="Back to top">
        <i class="fas fa-arrow-up"></i>
    </button>

    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
        <div class="container">
            <a class="navbar-brand" href="/">
                <i class="fas fa-map-marked-alt"></i> Tourism Guide
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="/"><i class="fas fa-home"></i> Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/#destinations"><i class="fas fa-map-pin"></i> Destinations</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Success Alert -->
    {% if success %}
    <div class="alert alert-success alert-dismissible fade show m-3" role="alert" style="margin-top: 76px !important;">
        <i class="fas fa-check-circle"></i> Thank you! Your review has been submitted successfully.
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
    {% endif %}

    <!-- Breadcrumb -->
    <div class="container mt-3" style="padding-top: 76px;">
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="/"><i class="fas fa-home"></i> Home</a></li>
                <li class="breadcrumb-item"><a href="/#destinations">Destinations</a></li>
                <li class="breadcrumb-item active" aria-current="page">{{ destination.name }}</li>
            </ol>
        </nav>
    </div>

    <!-- Hero Section -->
    <div class="hero-image" style="background-image: url('{% if destination.image_path %}{{ UPLOAD_URL }}{{ destination.image_path }}{% else %}https://via.placeholder.com/800x400?text={{ destination.name }}{% endif %}');">
        <div class="hero-overlay">
            <div class="container">
                <span class="badge bg-primary mb-2">
                    <i class="fas {{ destination.icon }}"></i> {{ destination.category_name }}
                </span>
                <h1 class="display-4 fw-bold">{{ destination.name }}</h1>
                {% if rating_count > 0 %}
                <div class="rating mb-2">
                    {% for i in range(5) %}
                        {% if i < avg_rating|round|int %}
                        <i class="fas fa-star"></i>
                        {% else %}
                        <i class="far fa-star"></i>
                        {% endif %}
                    {% endfor %}
                    <span class="ms-2">{{ "%.1f"|format(avg_rating) }} / 5</span>
                    <span class="ms-2">({{ rating_count }} reviews)</span>
                </div>
                {% endif %}
                <p class="lead"><i class="fas fa-map-marker-alt"></i> {{ destination.address }}</p>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="container my-5">
        <div class="row">
            <div class="col-lg-8">
                <!-- Description -->
                <div class="card mb-4">
                    <div class="card-body">
                        <h3 class="card-title"><i class="fas fa-info-circle"></i> About This Place</h3>
                        <p class="card-text">{{ destination.description|replace('\n', '<br>')|safe }}</p>
                    </div>
                </div>

                <!-- Gallery -->
                {% if images %}
                <div class="card mb-4">
                    <div class="card-body">
                        <h3 class="card-title"><i class="fas fa-images"></i> Photo Gallery</h3>
                        <div class="row g-2">
                            {% for img in images %}
                            <div class="col-md-4">
                                <a href="{{ UPLOAD_URL }}{{ img.image_path }}" 
                                   data-lightbox="gallery" 
                                   data-title="{{ img.caption }}">
                                    <img src="{{ UPLOAD_URL }}{{ img.image_path }}" 
                                         class="img-fluid gallery-img" 
                                         alt="{{ img.caption }}">
                                </a>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
                {% endif %}

                <!-- Map -->
                {% if destination.latitude and destination.longitude %}
                <div class="card mb-4">
                    <div class="card-body">
                        <h3 class="card-title"><i class="fas fa-map"></i> Location</h3>
                        <div id="map"></div>
                    </div>
                </div>
                {% endif %}

                <!-- Reviews Section -->
                <div class="card mb-4">
                    <div class="card-header bg-success text-white">
                        <h4 class="mb-0"><i class="fas fa-comments"></i> Reviews & Ratings</h4>
                    </div>
                    <div class="card-body">
                        {% if reviews %}
                            <h5 class="mb-3">What visitors are saying:</h5>
                            {% for review in reviews %}
                            <div class="review-card">
                                <div class="d-flex justify-content-between align-items-start mb-2">
                                    <div>
                                        <h6 class="mb-1"><i class="fas fa-user-circle"></i> {{ review.user_name }}</h6>
                                        <div class="review-rating">
                                            {% for i in range(5) %}
                                                {% if i < review.rating %}
                                                <i class="fas fa-star"></i>
                                                {% else %}
                                                <i class="far fa-star"></i>
                                                {% endif %}
                                            {% endfor %}
                                        </div>
                                    </div>
                                    <small class="text-muted">
                                        <i class="fas fa-clock"></i> {{ review.created_at.strftime('%b %d, %Y') }}
                                    </small>
                                </div>
                                <p class="mb-0">{{ review.comment|replace('\n', '<br>')|safe }}</p>
                            </div>
                            {% endfor %}
                        {% else %}
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle"></i> No reviews yet. Be the first to share your experience!
                        </div>
                        {% endif %}
                    </div>
                </div>

                <!-- Write Review Section -->
                <div class="card mb-4">
                    <div class="card-header bg-primary text-white">
                        <h4 class="mb-0"><i class="fas fa-pen"></i> Write a Review</h4>
                    </div>
                    <div class="card-body">
                        <form method="POST" action="/destination/{{ destination.id }}/review">
                            <div class="mb-3">
                                <label for="review_name" class="form-label">Your Name <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="review_name" name="review_name" required>
                            </div>

                            <div class="mb-3">
                                <label class="form-label">Rating <span class="text-danger">*</span></label>
                                <div class="star-rating" id="starRating">
                                    <i class="far fa-star" data-rating="1"></i>
                                    <i class="far fa-star" data-rating="2"></i>
                                    <i class="far fa-star" data-rating="3"></i>
                                    <i class="far fa-star" data-rating="4"></i>
                                    <i class="far fa-star" data-rating="5"></i>
                                </div>
                                <input type="hidden" id="rating" name="rating" required>
                                <small class="text-muted">Click on the stars to rate</small>
                            </div>

                            <div class="mb-3">
                                <label for="comment" class="form-label">Your Review <span class="text-danger">*</span></label>
                                <textarea class="form-control" id="comment" name="comment" rows="4" 
                                          placeholder="Share your experience about this place..." required></textarea>
                            </div>

                            <button type="submit" class="btn btn-success">
                                <i class="fas fa-paper-plane"></i> Submit Review
                            </button>
                        </form>
                    </div>
                </div>
            </div>

            <div class="col-lg-4">
                <!-- Quick Info -->
                <div class="card mb-4">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0"><i class="fas fa-clipboard-list"></i> Quick Information</h5>
                    </div>
                    <div class="card-body">
                        {% if destination.opening_hours %}
                        <div class="info-card">
                            <h6><i class="fas fa-clock"></i> Opening Hours</h6>
                            <p class="mb-0">{{ destination.opening_hours }}</p>
                        </div>
                        {% endif %}

                        {% if destination.entry_fee %}
                        <div class="info-card">
                            <h6><i class="fas fa-ticket-alt"></i> Entry Fee</h6>
                            <p class="mb-0">{{ destination.entry_fee }}</p>
                        </div>
                        {% endif %}

                        {% if destination.contact_number %}
                        <div class="info-card">
                            <h6><i class="fas fa-phone"></i> Contact</h6>
                            <p class="mb-0">{{ destination.contact_number }}</p>
                        </div>
                        {% endif %}

                        {% if destination.email %}
                        <div class="info-card">
                            <h6><i class="fas fa-envelope"></i> Email</h6>
                            <p class="mb-0">{{ destination.email }}</p>
                        </div>
                        {% endif %}

                        {% if destination.website %}
                        <div class="info-card">
                            <h6><i class="fas fa-globe"></i> Website</h6>
                            <p class="mb-0">
                                <a href="{{ destination.website }}" target="_blank">Visit Website</a>
                            </p>
                        </div>
                        {% endif %}
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="card">
                    <div class="card-body">
                        <h5><i class="fas fa-map-marked-alt"></i> Plan Your Visit</h5>
                        <a href="/#routes" class="btn btn-primary w-100 mb-2">
                            <i class="fas fa-route"></i> Find Route Here
                        </a>
                        <a href="/#destinations" class="btn btn-outline-primary w-100">
                            <i class="fas fa-compass"></i> Explore More Places
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-dark text-white text-center py-4">
        <p>&copy; 2025 Tourism Guide System. All rights reserved.</p>
        <p><small>Powered by OpenStreetMap & Leaflet (100% Free)</small></p>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lightbox2/2.11.3/js/lightbox.min.js"></script>
    
    <script>
        // Star Rating System
        const stars = document.querySelectorAll('#starRating i');
        const ratingInput = document.getElementById('rating');
        
        stars.forEach(star => {
            star.addEventListener('click', function() {
                const rating = this.getAttribute('data-rating');
                ratingInput.value = rating;
                
                stars.forEach((s, index) => {
                    if (index < rating) {
                        s.classList.remove('far');
                        s.classList.add('fas', 'active');
                    } else {
                        s.classList.remove('fas', 'active');
                        s.classList.add('far');
                    }
                });
            });
            
            star.addEventListener('mouseenter', function() {
                const rating = this.getAttribute('data-rating');
                stars.forEach((s, index) => {
                    if (index < rating) {
                        s.classList.add('active');
                    } else {
                        s.classList.remove('active');
                    }
                });
            });
        });
        
        document.getElementById('starRating').addEventListener('mouseleave', function() {
            const currentRating = ratingInput.value;
            stars.forEach((s, index) => {
                if (currentRating && index < currentRating) {
                    s.classList.add('active');
                } else {
                    s.classList.remove('active');
                }
            });
        });

        // Initialize Leaflet map
        {% if destination.latitude and destination.longitude %}
        const map = L.map('map').setView([{{ destination.latitude }}, {{ destination.longitude }}], 15);
        
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; OpenStreetMap',
            maxZoom: 19
        }).addTo(map);
        
        L.marker([{{ destination.latitude }}, {{ destination.longitude }}])
            .addTo(map)
            .bindPopup('<h6>{{ destination.name }}</h6><p>{{ destination.address }}</p>')
            .openPopup();
        {% endif %}
        
        // Back to Top Button
        const backToTopBtn = document.getElementById('backToTop');
        
        window.addEventListener('scroll', () => {
            if (window.pageYOffset > 300) {
                backToTopBtn.classList.add('show');
            } else {
                backToTopBtn.classList.remove('show');
            }
        });
        
        backToTopBtn.addEventListener('click', () => {
            window.scrollTo({top: 0, behavior: 'smooth'});
        });
    </script>
</body>
</html>
